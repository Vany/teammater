<!doctype html>
<html lang="ru">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>BRB â€” Neko Arc</title>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            background: #000;
            font-family: system-ui, sans-serif;
        }
        .wrap {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .bg {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
        }
        .shade {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.01);
        }
        #t {
            position: absolute;
            inset: auto 0 6vh 0;
            margin: auto;
            text-align: center;
            font-variant-numeric: tabular-nums;
            line-height: 1;
            font-weight: 900;
            color: #fff;
            text-shadow:
                0 6px 18px rgba(0, 0, 0, 0.85),
                0 0 2px #000;
            font-size: clamp(48px, 18vw, 220px);
            user-select: none;
        }
    </style>
    <div class="wrap">
        <div class="bg"></div>
        <div class="shade"></div>
        <div id="t">10:00</div>
    </div>
    <script>
        (function () {
            function q(n, d) {
                const v = new URLSearchParams(location.search).get(n),
                    i = parseInt(v, 10);
                return Number.isFinite(i) && i >= 0 ? i : d;
            }
            function fmt(s) {
                return (
                    ("" + Math.floor(s / 60)).padStart(2, "0") +
                    ":" +
                    ("" + (s % 60)).padStart(2, "0")
                );
            }

            // Background selection (n=1 or n=2)
            const bg =
                q("n", 1) === 2
                    ? "nekoarc/NEKOARC-WC.png"
                    : "nekoarc/NEKOARC-eat.png";
            document.querySelector(".bg").style.backgroundImage =
                `url('${bg}')`;

            // Random sound selection
            const sounds = [
                "nekoarc/vanechka-vernis-u-n_neko-ark.ogg",
                "nekoarc/vanechka-vernis-u-n_neko-ark-2.ogg",
                "nekoarc/vanechka-vernis-u-n_zlaya-neko-ark.ogg",
            ];
            const audio = new Audio(
                sounds[Math.floor(Math.random() * sounds.length)],
            );
            audio.preload = "auto";

            // Audio unlock on first interaction
            let unlocked = false;
            function unlock() {
                if (!unlocked) {
                    audio
                        .play()
                        .then(() => {
                            audio.pause();
                            audio.currentTime = 0;
                            unlocked = true;
                            console.log("Audio unlocked");
                        })
                        .catch(() => {});
                }
            }
            document.addEventListener("click", unlock);
            document.addEventListener("keydown", unlock);
            document.addEventListener("touchstart", unlock);

            // Countdown
            let left = q("t", 600),
                el = document.getElementById("t");
            el.textContent = fmt(left);
            const id = setInterval(() => {
                left--;
                if (left <= 0) {
                    left = 0;
                    clearInterval(id);
                    audio.currentTime = 0;
                    audio
                        .play()
                        .catch((e) => console.error("Audio failed:", e));
                }
                el.textContent = fmt(left);
            }, 1000);
        })();
    </script>
</html>
